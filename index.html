<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<title>单机版捕鱼达人</title>
		<style type="text/css">
			*{margin: 0;padding: 0;}
			body{text-align: center;background: #000;}
			#playBox{background: #000 url(images/game_bg.jpg) no-repeat;}
		</style>
		<script type="text/javascript" src="src/util.js"></script><!-- 工具 -->
		<script type="text/javascript" src="src/material.js"></script><!-- 素材 -->

		<script type="text/javascript">
			//fish
			function Fish(img, w, h, maxFrame){//图片,宽度,高度,最大帧数
				this.x = 0;
				this.y = 0;

				this.img = img;
				this.w = w;
				this.h = h;

				this.maxFrame = maxFrame;
				this.nowFrame = 0;//当前帧数

				this.speed = 0;//鱼游动的速度
			};
			//绘制鱼
			Fish.prototype.draw = function(gd){
				//剪切图像，并在画布上定位被剪切的部分：context.drawImage(img,sx,sy,swidth,sheight,x,y,width,height);
				//规定要使用的图像,开始剪切的 x 坐标位置,开始剪切的 y 坐标位置,被剪切图像的宽度,被剪切图像的高度,在画布上放置图像的 x 坐标位置,在画布上放置图像的 y 坐标位置,要使用的图像的宽度,要使用的图像的高度
				gd.drawImage(this.img, 0, this.nowFrame*this.h, this.w, this.h, this.x - this.w/2, this.y - this.h/2, this.w, this.h);
			};
			//鱼的换图动作
			Fish.prototype.nextFrame = function(){
				this.nowFrame++;
				if(this.nowFrame >= this.maxFrame){
					this.nowFrame = 0;
				}
			};
			//鱼的移动
			Fish.prototype.move = function(){
				this.x += this.speed;
			};

			//加载
			document.addEventListener('DOMContentLoaded', function(){
				var oBox = document.getElementById('playBox');//游戏盒子
				var gd = oBox.getContext('2d');//用来绘制元素
				//加载图片
				util.loadImages(['fish1.png', 'fish2.png'], function(imgs){
					//加载成功
					var f1 = new Fish(imgs.fish1, 55, 37, 4);
					f1.x=100;
					f1.y=100;
					f1.speed = Math.random() * 2 + 1;
					//两个定时器 一个处理换图 一个处理移动绘制
					//绘制
					setInterval(function(){
						//清除画布
						gd.clearRect(0, 0, oBox.width, oBox.height);
						//绘制鱼
						f1.move();
						f1.draw(gd);
					}, 16);
					//换图
					setInterval(function(){
						f1.nextFrame();
					}, 150);

				}, function(){
					//加载失败
					alert('加载失败，请刷新重试。');
				});

			}, false);	
		</script>
	</head>
	<body>
		<canvas id="playBox" width="1024" height="700"></canvas>
	</body>
</html>